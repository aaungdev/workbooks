from jira import JIRA

ENV_VALUES = {
    "JIRA_API_TOKEN": "your_api_token_here",
    "JIRA_BASE_URL": "https://yourcompany.atlassian.net",
}

class JiraQuerier:
    _jira_api = None

    @classmethod
    def setup_jira_api(cls):
        if cls._jira_api is None:
            cls._jira_api = JIRA(
                token_auth=ENV_VALUES["JIRA_API_TOKEN"],
                server=ENV_VALUES["JIRA_BASE_URL"],
                kerberos=True,
                options={"verify": False},
            )

    @classmethod
    def get_components_by_project(cls, project_key):
        cls.setup_jira_api()
        jql = f'project = {project_key}'
        issues = cls._jira_api.search_issues(jql, maxResults=50)
        result = {}
        for issue in issues:
            comps = issue.fields.components
            comp_names = [c.name for c in comps] if comps else []
            result[issue.key] = comp_names
        return result

if __name__ == "__main__":
    components = JiraQuerier.get_components_by_project("GRAAMG")
    for issue_key, comp_list in components.items():
        print(f"{issue_key}: Component(s) = {comp_list}")